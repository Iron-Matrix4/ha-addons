FROM alpine:latest

# Install dependencies (bash, jq for startup script)
RUN apk add --no-cache \
    bash \
    jq \
    wget \
    ca-certificates \
    icu-libs \
    libgcc \
    libstdc++ \
    unzip

# Install .NET 8 runtime for ASF
RUN wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh && \
    chmod +x dotnet-install.sh && \
    ./dotnet-install.sh --channel 10.0 --runtime aspnetcore --install-dir /usr/share/dotnet && \
    ln -s /usr/share/dotnet/dotnet /usr/bin/dotnet && \
    rm dotnet-install.sh

# Download and install ArchiSteamFarm (Generic for .NET runtime)
RUN mkdir -p /app/asf && \
    wget https://github.com/JustArchiNET/ArchiSteamFarm/releases/latest/download/ASF-generic.zip -O /tmp/asf.zip && \
    unzip /tmp/asf.zip -d /app/asf && \
    rm /tmp/asf.zip

# DO NOT install FreePackages plugin - it ignores MinReviewScore config
# Configuration will be generated by startup script with correct values

# Copy rootfs
COPY rootfs/ /

# Create config directory
RUN mkdir -p /config/asf/config

WORKDIR /app
CMD ["/etc/cont-init.d/10-asf-start.sh"]
